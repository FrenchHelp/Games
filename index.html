<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3TK4GBLMT4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-3TK4GBLMT4');
  </script>

  <meta charset="UTF-8">
  <title>PlayHub Launcher</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- AdSense (LOAD ONCE) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3756925945648627"
    crossorigin="anonymous"></script>

<link rel="stylesheet" href="styles.css" />
  </head>

<body>

  <header>
    <input id="search" placeholder="Search gamesâ€¦" />

    <select id="sort">
      <option value="popularity" selected>Sort: Popularity</option>
      <option value="name">Sort: Name</option>
    </select>

    <select id="pageSize">
      <option value="50">50 / page</option>
      <option value="100" selected>100 / page</option>
    </select>

    <div class="ad-container">
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3756925945648627" data-ad-slot="4229355123"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    </div>
  </header>

  <main>
    <div id="grid" class="grid"></div>
    <div id="pagination" class="pagination"></div>
  </main>

  <script>
    let games = [];
    let filtered = [];
    let page = 0;
    let PAGE_SIZE = 100;
    let searchTimer;

    fetch("games.json")
      .then(r => r.json())
      .then(data => {
        games = data;
        applyFilter();
      });

    const searchInput = document.getElementById("search");
    const sortSelect = document.getElementById("sort");
    const pageSizeSelect = document.getElementById("pageSize");

    searchInput.oninput = () => {
      clearTimeout(searchTimer);
      searchTimer = setTimeout(() => {
        page = 0;
        applyFilter();
      }, 150);
    };

    sortSelect.onchange = () => {
      page = 0;
      applyFilter();
    };

    pageSizeSelect.onchange = e => {
      PAGE_SIZE = +e.target.value;
      page = 0;
      render();
    };

    function applyFilter() {
      const q = searchInput.value.toLowerCase();
      filtered = games.filter(g => g.name.toLowerCase().includes(q));

      if (sortSelect.value === "name") {
        filtered.sort((a, b) => a.name.localeCompare(b.name));
      } else {
        filtered.sort((a, b) => (b.popularity ?? 0) - (a.popularity ?? 0));
      }

      render();
    }

    function render() {
      renderGrid();
      renderPagination();
    }

    function renderGrid() {
      const grid = document.getElementById("grid");
      grid.innerHTML = "";

      const start = page * PAGE_SIZE;
      const items = filtered.slice(start, start + PAGE_SIZE);

      const frag = document.createDocumentFragment();

      for (const g of items) {
        const card = document.createElement("div");
        card.className = "card";

        const img = document.createElement("img");
        img.loading = "lazy";
        img.src = `icons/${g.image || g.path.replace(".html", ".png")}`;

        const name = document.createElement("div");
        name.className = "name";
        name.textContent = g.name;

        card.onclick = () => openGame(g.path);

        card.append(img, name);
        frag.appendChild(card);
      }

      grid.appendChild(frag);
    }

    function renderPagination() {
      const p = document.getElementById("pagination");
      p.innerHTML = "";

      const pages = Math.ceil(filtered.length / PAGE_SIZE);

      for (let i = 0; i < pages; i++) {
        const b = document.createElement("button");
        b.textContent = i + 1;
        if (i === page) b.classList.add("active");

        b.onclick = () => {
          page = i;
          render();
          window.scrollTo({ top: 0, behavior: "smooth" });
        };

        p.appendChild(b);
      }
    }

    function openGame(path) {
      const win = window.open("about:blank", "_blank");
      win.document.body.style.margin = "0";
      win.document.body.style.background = "black";

      const iframe = win.document.createElement("iframe");
      iframe.src = `games/${path}`;
      iframe.style.width = "100%";
      iframe.style.height = "100vh";
      iframe.style.border = "none";

      win.document.body.appendChild(iframe);
    }

    window.addEventListener("load", () => {
      setTimeout(() => {
        try {
          (adsbygoogle = window.adsbygoogle || []).push({});
        } catch { }
      }, 500);
    });
  </script>

</body>

</html>