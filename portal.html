<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PlayHub Portal</title>

<link rel="stylesheet" href="../assets/css/game.css" />
<script src="https://kit.fontawesome.com/7e6a1aef81.js" crossorigin="anonymous"></script>

<style>
  /* Dark Futuristic Styling */
  body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: 'Inter', sans-serif;
    background: #0f111a;
    color: #e0e0e0;
    overflow: hidden;
  }

  #game-container {
    height: 100%;
    width: 100%;
    position: relative;
  }

  iframe#game-frame {
    border: none;
    height: 100vh;
    width: 100vw;
  }

  #menu-bar {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: 10px 0;
    background: rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 25px;
    z-index: 10;
    transition: opacity 0.3s ease;
  }

  #menu-bar.hidden { opacity: 0; pointer-events: none; }

  .menu-icon {
    width: 24px;
    height: 24px;
    cursor: pointer;
    filter: brightness(1.2);
    transition: transform 0.2s, filter 0.2s;
  }

  .menu-icon:hover {
    transform: scale(1.2);
    filter: drop-shadow(0 0 6px #9d00ff);
  }

  #menu-toggle {
    position: absolute;
    top: 10px;
    right: 20px;
    width: 24px;
    height: 24px;
    cursor: pointer;
    z-index: 11;
    filter: brightness(1.2);
    transition: transform 0.2s, filter 0.2s;
  }
  #menu-toggle:hover {
    transform: scale(1.2);
    filter: drop-shadow(0 0 6px #00f0ff);
  }
</style>
</head>

<body>
<div id="game-container">
  <img id="menu-toggle" src="../assets/icons/menu.png" alt="Menu Toggle" />

  <div id="menu-bar">
    <a href="../games.html"><img src="../assets/icons/arrow.png" class="menu-icon" title="Back"></a>
    <a href="../index.html"><img src="../assets/icons/home.png" class="menu-icon" title="Home"></a>
    <img src="../assets/icons/fullscreen.png" class="menu-icon" id="fullscreen-btn" title="Fullscreen">
    <img src="../assets/icons/share.png" class="menu-icon" id="share-btn" title="Share">
    <img src="../assets/icons/volume.png" class="menu-icon" id="volume-btn" title="Toggle Mute">
    <img src="../assets/icons/tab.png" class="menu-icon" id="popup-btn" title="Open in new Tab">
  </div>

  <iframe id="game-frame" src=""></iframe>
</div>

<script>
// Refuse to run when loaded as a top-level page (must be embedded in an iframe)
if (window.top === window.self) {
  // Replace page contents with a clear message and stop further script execution
  document.body.style.margin = '0';
  document.body.style.height = '100vh';
  document.body.style.display = 'flex';
  document.body.style.justifyContent = 'center';
  document.body.style.alignItems = 'center';
  document.body.style.background = '#0f111a';
  document.body.innerHTML = '<div style="color:#e0e0e0;font-family:Inter,sans-serif;text-align:center;padding:20px;"><h1 style="margin:0 0 8px;">This page must be embedded</h1><p style="margin:0;opacity:.9;">PlayHub portal refuses to run outside of an iframe.</p></div>';
  throw new Error('Refused to run outside of an iframe');
}

const menuBar = document.getElementById("menu-bar");
const menuToggle = document.getElementById("menu-toggle");
let menuVisible = true;

menuToggle.addEventListener("click", () => {
  menuVisible = !menuVisible;
  menuBar.classList.toggle("hidden", !menuVisible);
});

// Load game dynamically via query parameter
const params = new URLSearchParams(window.location.search);
const gameFile = params.get('game') || 'defaultGame.html';
document.getElementById("game-frame").src = `../games/${gameFile}`;

// Fullscreen
document.getElementById("fullscreen-btn").addEventListener("click", () => {
  const iframe = document.getElementById("game-frame");
  if (iframe.requestFullscreen) iframe.requestFullscreen();
  else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
  else if (iframe.msRequestFullscreen) iframe.msRequestFullscreen();
});

// Share button
document.getElementById("share-btn").addEventListener("click", async () => {
  try {
    await navigator.share({ title: document.title, url: window.location.href });
  } catch(e) { alert("Sharing not supported."); }
});

// Mute toggle (icon only)
const volumeBtn = document.getElementById("volume-btn");
let isMuted = false;
volumeBtn.addEventListener("click", () => {
  isMuted = !isMuted;
  volumeBtn.src = isMuted ? "../assets/icons/mute.png" : "../assets/icons/volume.png";
});

// Open in new about:blank tab
document.getElementById("popup-btn").addEventListener("click", () => {
  const iframe = document.getElementById("game-frame");
  const win = window.open("about:blank");
  win.document.write(`
    <html>
      <head><title>PlayHub Game</title>
      <style>html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#000; } iframe { width:100%; height:100%; border:none; }</style>
      </head>
      <body><iframe src="${iframe.src}"></iframe></body>
    </html>
  `);
  win.document.close();
});
</script>
</body>
</html>
